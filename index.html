<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Get Gmail Token</title>
</head>
<body>
  <h1>Get Gmail Token</h1>
  
  <!-- Input fields for client ID and secret -->
  <div>
    <label for="client_id">Client ID:</label>
    <input type="text" id="client_id" placeholder="Enter Client ID" />
  </div>
  <div>
    <label for="client_secret">Client Secret:</label>
    <input type="text" id="client_secret" placeholder="Enter Client Secret" />
  </div>

  <button id="signin_button">Sign in with Google</button>

  <div id="token_info">
    <p id="access_token"></p>
    <p id="refresh_token"></p>
  </div>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    const signinButton = document.getElementById('signin_button');
    const accessTokenElement = document.getElementById('access_token');
    const refreshTokenElement = document.getElementById('refresh_token');

    signinButton.addEventListener('click', () => {
      const clientId = document.getElementById('client_id').value.trim();
      const clientSecret = document.getElementById('client_secret').value.trim();
      
      if (!clientId || !clientSecret) {
        alert('Please provide both Client ID and Client Secret');
        return;
      }

      const googleLogin = google.accounts.id.initialize({
        client_id: clientId,
        callback: handleCredentialResponse,
      });

      google.accounts.id.prompt(); // Trigger Google login
    });

    function handleCredentialResponse(response) {
      const authCode = response.credential;

      console.log('Auth Code:', authCode);

      // Step 2: Exchange the authorization code for tokens (access token and refresh token)
      const tokenUrl = 'https://oauth2.googleapis.com/token';
      const data = {
        code: authCode, // The authorization code received from Google
        client_id: document.getElementById('client_id').value.trim(), // Your client ID
        client_secret: document.getElementById('client_secret').value.trim(), // Your client secret
        redirect_uri: 'https://kulovacnedim.github.io/get-gmail-token/', // Your redirect URI
        grant_type: 'authorization_code',
        access_type: 'offline', // This requests the refresh token
      };

      fetch(tokenUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams(data),
      })
        .then(response => response.json())
        .then(tokens => {
          console.log('Token exchange response:', tokens);

          const accessToken = tokens.access_token;
          const refreshToken = tokens.refresh_token; // This should be included now

          accessTokenElement.textContent = `Access Token: ${accessToken}`;
          refreshTokenElement.textContent = `Refresh Token: ${refreshToken}`;

          console.log('Access Token:', accessToken);
          console.log('Refresh Token:', refreshToken);
        })
        .catch(error => {
          console.error('Error during token exchange:', error);
          alert('An error occurred while exchanging the token. Please try again.');
        });
    }
  </script>
</body>
</html>
